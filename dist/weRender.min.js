!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.weRender=t.weRender||{})}(this,function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},i=function(){function t(){e(this,t),this._actions=[]}return r(t,[{key:"getActions",value:function(){return this._actions}},{key:"setActions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Array.isArray(t)&&(this._actions=t)}},{key:"clearRect",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"clearRect",args:e}),this}},{key:"fillRect",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"fillRect",args:e}),this}},{key:"strokeRect",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"strokeRect",args:e}),this}},{key:"fillText",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"fillText",args:e}),this}},{key:"strokeText",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"strokeText",args:e}),this}},{key:"measureText",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"measureText",args:e}),this}},{key:"lineWidth",value:function(t){return this._actions.push({type:"property",method:"lineWidth",args:t}),this}},{key:"lineCap",value:function(t){return this._actions.push({type:"property",method:"lineCap",args:t}),this}},{key:"lineJoin",value:function(t){return this._actions.push({type:"property",method:"lineJoin",args:t}),this}},{key:"font",value:function(t){return this._actions.push({type:"property",method:"font",args:t}),this}},{key:"textAlgin",value:function(t){return this._actions.push({type:"property",method:"textAlgin",args:t}),this}},{key:"textBaseline",value:function(t){return this._actions.push({type:"property",method:"textBaseline",args:t}),this}},{key:"direction",value:function(t){return this._actions.push({type:"property",method:"direction",args:t}),this}},{key:"fillStyle",value:function(t){return this._actions.push({type:"property",method:"fillStyle",args:t}),this}},{key:"strokeStyle",value:function(t){return this._actions.push({type:"property",method:"strokeStyle",args:t}),this}},{key:"beginPath",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"beginPath",args:e}),this}},{key:"closePath",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"closePath",args:e}),this}},{key:"moveTo",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"moveTo",args:e}),this}},{key:"lineTo",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"lineTo",args:e}),this}},{key:"bezierCurveTo",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"bezierCurveTo",args:e}),this}},{key:"quadraticCurveTo",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"quadraticCurveTo",args:e}),this}},{key:"arc",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"arc",args:e}),this}},{key:"arcTo",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"arcTo",args:e}),this}},{key:"rect",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"rect",args:e}),this}},{key:"fill",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"fill",args:e}),this}},{key:"stroke",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"stroke",args:e}),this}},{key:"rotate",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"rotate",args:e}),this}},{key:"scale",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"scale",args:e}),this}},{key:"translate",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"translate",args:e}),this}},{key:"transform",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"transform",args:e}),this}},{key:"resetTransform",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"resetTransform",args:e}),this}},{key:"drawImage",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"drawImage",args:e}),this}},{key:"createImageData",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"createImageData",args:e}),this}},{key:"getImageData",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"getImageData",args:e}),this}},{key:"putImageData",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"putImageData",args:e}),this}},{key:"save",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"save",args:e}),this}},{key:"restore",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._actions.push({type:"method",method:"restore",args:e}),this}},{key:"shadowColor",value:function(t){return this._actions.push({type:"property",method:"shadowColor",args:t}),this}},{key:"shadowBlur",value:function(t){return this._actions.push({type:"property",method:"shadowBlur",args:t}),this}}]),t}(),s=function(t){function i(t){e(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r._rendered=!1,r._init(t),r.width=r.canvas.width,r.height=r.canvas.height,r}return n(i,t),r(i,[{key:"_initMethods",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,r){return t[r]||(t._proxy(r),e[r]=!0),e},{})}},{key:"_init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.canvas,r=t.actions,n=t.width,a=t.height,i=t.x,s=t.y,o=t.methods;this.canvas=e||document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this._initMethods(o),this.setSize(n,a),this.setCoordinate(i,s),this.setActions(r)}},{key:"_proxy",value:function(t){var e=this,r=this._ctx[t],n=null;"undefined"!==r&&(n="[object Function]"===Object.prototype.toString.call(r)?function(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return e._actions.push({type:"method",method:t,args:n}),e}:function(r){return e._actions.push({type:"property",method:t,args:r}),e},this[t]=n)}},{key:"setSize",value:function(t,e){return t&&t!==this.width&&(this.canvas.width=t,this.width=t),e&&e!==this.height&&(this.canvas.height=e,this.height=e),this}},{key:"setStyle",value:function(t,e){return t&&(this.canvas.style.width=t),e&&(this.canvas.style.height=e),this}},{key:"setCoordinate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t,this.y=e,this}},{key:"setScale",value:function(t){this._ctx.scale(t,t)}},{key:"clear",value:function(){this._ctx.clearRect(0,0,this.width,this.height),this.setActions([])}},{key:"draw",value:function(){var t=this;if(!(this._rendered&&this._cache||!this._actions.length))return this._actions.forEach(function(e){var r=e.type,n=e.method,a=e.args;"method"===r?t._ctx[n].apply(t._ctx,a):t._ctx[n]=a}),this._rendered||(this._rendered=!0),this}},{key:"cache",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return"boolean"==typeof t&&(this._cache=t),this}}]),i}(i),o=function(){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this._canvas=new s({canvas:r}).cache(!1),this._children=[],this._updating=!1,this._init(n)}return r(t,[{key:"_initOptions",value:function(t){var e=t.clear,r=void 0===e||e,n=t.ratio,a=void 0===n?1:n;"boolean"==typeof r&&(this._clear=r),"number"==typeof a&&(this._ratio=a)}},{key:"_init",value:function(t){this._initOptions(t);var e=this._canvas,r=e.width,n=e.height;this._offScreenCanvas=new s({width:r,height:n}).cache(!1)}},{key:"setSize",value:function(t,e){this._canvas.setSize(t,e),this._offScreenCanvas.setSize(t,e),this._offScreenCanvas.setScale(this._ratio)}},{key:"setStyle",value:function(t,e){this._canvas.setStyle(t,e)}},{key:"destory",value:function(){this._canvas=null,this._offScreenCanvas=null,this._children=[]}},{key:"clear",value:function(){this._offScreenCanvas.clear(),this._canvas.clear()}},{key:"addChild",value:function(t){(t instanceof s||t.canvas.getContext("2d"))&&this._children.push(t)}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"number"==typeof t&&"number"==typeof e&&(this._coordinate={x:t,y:e}),"boolean"==typeof r&&(this._translateReset=r)}},{key:"update",value:function(){this._children.length&&!this._updating&&(this._updating=!0,this._clear&&this.clear(),this._translateStage(),this._drawChildren(),this._resetCoordinate(),this._offScreenCanvas.draw(),this._updateStage(),this._updating=!1,this._children=[])}},{key:"_translateStage",value:function(){if(this._coordinate){var t=this._coordinate,e=t.x,r=t.y;this._offScreenCanvas.translate(e,r)}}},{key:"_resetCoordinate",value:function(){if(this._translateReset){var t=this._coordinate,e=t.x,r=t.y;this._offScreenCanvas.translate(-e,-r),this._coordinate=null}}},{key:"_drawChildren",value:function(){var t=this;this._children.forEach(function(e){e instanceof s?t._drawChild(e):t._drawChildCanvas(e)})}},{key:"_drawChild",value:function(t){var e=t.canvas,r=t.x,n=t.y,a=t.width,i=t.height;t.draw(),this._offScreenCanvas.drawImage(e,r,n,a/this._ratio,i/this._ratio)}},{key:"_drawChildCanvas",value:function(t){var e=t.x,r=void 0===e?0:e,n=t.y,a=void 0===n?0:n,i=t.canvas;this._offScreenCanvas.drawImage(i,r,a,i.width/this._ratio,i.height/this._ratio)}},{key:"_updateStage",value:function(){this._canvas.drawImage(this._offScreenCanvas.canvas,0,0),this._canvas.draw()}}]),t}();t.WeCanvas=s,t.WeStage=o,Object.defineProperty(t,"__esModule",{value:!0})});
